# Bounding Box Lines for Adobe After Effects

## 概要

**kg_BoundingBoxLines.jsx** は、選択したレイヤーのバウンディングボックスに沿った4本の線（上・下・左・右）を自動生成するスクリプトです。テキストやオブジェクトの周囲に装飾的な線を追加する際に便利です。

### バージョン
- 現在: **v1.2**

---

## 主な機能

| 機能 | 説明 |
|------|------|
| **4辺の線を生成** | 上・下・左・右の4本の線を個別のシェイプレイヤーとして作成 |
| **親子関係** | 線レイヤーは元レイヤーの子になり、追従する |
| **線の範囲選択** | バウンディングボックス内 or 画面外まで伸ばす |
| **トリミング制御** | 線の表示範囲をアニメーション可能 |
| **余白（マージン）** | バウンディングボックスからの距離を調整可能 |
| **スケール補正** | 親レイヤーがスケールされても線幅が一定 |

---

## インストール方法

1. `kg_BoundingBoxLines.jsx` を保存
2. 以下のフォルダに配置:
   - **Windows**: `C:\Program Files\Adobe\Adobe After Effects <version>\Support Files\Scripts\ScriptUI Panels\`
   - **macOS**: `/Applications/Adobe After Effects <version>/Scripts/ScriptUI Panels/`
3. After Effectsを再起動
4. `ウィンドウ` → `kg_BoundingBoxLines` で開く

---

## 使い方

### 基本的な使い方

1. 線を追加したいレイヤーを選択
2. **線の設定** で調整:
   - **線幅**: 線の太さ（px）
   - **線の範囲**: バウンディングボックス内 or 画面外まで
   - **トリミング制御を追加**: チェックでTrim Path機能を追加
3. **適用** をクリック

### 線の範囲オプション

| オプション | 説明 |
|-----------|------|
| **バウンディングボックス内** | レイヤーの境界内に線を収める |
| **画面外まで伸ばす** | 線をコンポジションの外まで延長 |

画面外まで伸ばす場合、倍率（1.5倍/2倍/3倍）を選択できます。

---

## UI解説

### 線の設定パネル

| 項目 | 説明 | デフォルト |
|------|------|-----------|
| **線幅** | 線の太さ（px） | 2 |
| **線の色** | 白色（固定） | - |
| **線の範囲** | バウンディングボックス内 / 画面外まで | バウンディングボックス内 |
| **伸ばす倍率** | 画面外モード時の延長距離 | 3倍 |
| **トリミング制御を追加** | Trim Path機能の追加 | ON |
| **デバッグログを表示** | トラブルシューティング用 | OFF |

---

## 生成されるレイヤー構造

### 作成されるシェイプレイヤー

各辺に対して1つのシェイプレイヤーが作成されます：

- `[レイヤー名]_L_Top` - 上辺
- `[レイヤー名]_L_Bottom` - 下辺
- `[レイヤー名]_L_Left` - 左辺
- `[レイヤー名]_L_Right` - 右辺

すべての線レイヤーは元レイヤーの子として設定されます。

### 親レイヤーに追加されるエフェクト

| エフェクト名 | 種類 | 説明 |
|-------------|------|------|
| **BBox Line Width** | スライダー | 線幅の調整 |
| **BBox Line Color** | カラー | 線の色 |
| **BBox Margin** | スライダー | バウンディングボックスからの余白 |
| **BBox Trim Start** | スライダー | トリミング開始位置（0-100%） |
| **BBox Trim End** | スライダー | トリミング終了位置（0-100%） |

---

## トリミングアニメーション

### 基本的な使い方

1. スクリプト適用時に「トリミング制御を追加」をONにする
2. 親レイヤーのエフェクトコントロールで調整:
   - **BBox Trim Start**: 0% → 線が端から表示開始
   - **BBox Trim End**: 100% → 線が端まで表示

### アニメーション例：線が中心から広がる

```
0フレーム目:
  BBox Trim Start: 50%
  BBox Trim End: 50%

30フレーム目:
  BBox Trim Start: 0%
  BBox Trim End: 100%
```

### トリムの方向

- **Top, Left**: Trim Startが左/上から、Trim Endが右/下へ
- **Bottom, Right**: 自動的に反転され、中心から外側へ広がるように設定

---

## スケール補正の仕組み

親レイヤーがスケールされても、線幅が一定に保たれます。

```javascript
// 辺の向きに応じたスケール補正
// 水平線（Top/Bottom）はYスケールで補正
// 垂直線（Left/Right）はXスケールで補正
var scaleRatio = currentScale / initialScale;
baseWidth / scaleRatio;
```

これにより：
- 親レイヤーを拡大しても線が太くならない
- 親レイヤーを縮小しても線が細くならない

---

## 余白（マージン）の使い方

**BBox Margin** スライダーで、バウンディングボックスからの距離を調整できます。

| 値 | 効果 |
|----|------|
| **0** | バウンディングボックスぴったり |
| **正の値** | 外側に離れる |
| **負の値** | 内側に入り込む |

エクスプレッションで余白もスケール補正されるため、親のスケールに関係なく一定の距離を保ちます。

---

## トラブルシューティング

| 問題 | 原因 | 解決策 |
|------|------|--------|
| 線が表示されない | 線の色が背景と同じ | BBox Line Colorを変更 |
| 線の位置がずれる | 初期スケールの問題 | スケール100%の状態で適用 |
| エクスプレッションエラー | 親レイヤーが削除された | 線レイヤーも削除して再作成 |
| 線がガタガタ | sourceRectの変動 | 元レイヤーのアニメーションを確認 |

### デバッグモード

問題が発生した場合は「デバッグログを表示」をONにして適用すると、詳細なログが表示されます。

---

## ライセンス

このスクリプトはフリーで使用できます。

---

## 更新履歴

| バージョン | 内容 |
|-----------|------|
| 1.2 | Shapeオブジェクト互換性修正、スケール補正改善 |
| 1.1 | 余白制御、トリム反転機能追加 |
| 1.0 | 初期リリース |
