# Custom Wiggle Transform for Adobe After Effects

## 概要

**kg_WiggleTransform.jsx** は、選択レイヤーのトランスフォームプロパティ（位置・スケール・回転）に特別なwiggleエクスプレッションを適用するスクリプトです。レイヤーの始点と終点で大きく揺れ、中間では微細な揺れになる独自のアニメーション効果を実現します。

---

## 主な機能

| 機能 | 説明 |
|------|------|
| **端で大きく揺れる** | レイヤーのイン/アウトポイント付近で振幅が大きくなる |
| **中央で微細に** | レイヤーの中央部分では振幅が小さくなる |
| **複数プロパティ対応** | 位置・スケール・回転を個別に選択可能 |
| **レイヤーごとに異なる動き** | 自動的にシード値が変わり、各レイヤーが異なる動きをする |
| **一括制御** | 複数レイヤー選択時はヌルオブジェクトで一括調整可能 |
| **posterizeTime対応** | フレームレートを指定してカクカクした動きに |

---

## インストール方法

1. `kg_WiggleTransform.jsx` を保存
2. 以下のフォルダに配置:
   - **Windows**: `C:\Program Files\Adobe\Adobe After Effects <version>\Support Files\Scripts\`
   - **macOS**: `/Applications/Adobe After Effects <version>/Scripts/`
3. After Effectsで `ファイル` → `スクリプト` → `スクリプトファイルを実行` で実行

---

## 使い方

### 基本的な使い方

1. wiggleを適用したいレイヤーを選択（複数選択可）
2. スクリプトを実行
3. ダイアログで設定:
   - **適用するプロパティ**: 位置・スケール・回転から選択
   - **端の振幅**: 始点/終点での揺れの大きさ
4. **OK** をクリック

### 複数レイヤーの場合

複数レイヤーを選択した場合、自動的に「Wiggle Control」ヌルオブジェクトが作成され、すべてのレイヤーを一括で調整できます。

---

## ダイアログ設定

### プロパティ選択

| 項目 | 説明 |
|------|------|
| **位置** | Position プロパティにwiggleを適用 |
| **スケール** | Scale プロパティにwiggleを適用 |
| **回転** | Rotation プロパティにwiggleを適用 |

### デフォルト値

| 項目 | 説明 | デフォルト |
|------|------|-----------|
| **位置 - 端の振幅** | 位置の最大揺れ幅（px） | 50 |
| **スケール - 端の振幅** | スケールの最大揺れ幅（%） | 10 |
| **回転 - 端の振幅** | 回転の最大揺れ幅（度） | 15 |

---

## 適用後のコントロール

### 単一レイヤーモード

レイヤー自身のエフェクトコントロールに以下が追加されます：

| コントロール | 説明 |
|-------------|------|
| **Posterize Time Control** | フレームレート（デフォルト: 24） |
| **中央の周波数** | 中央部分のwiggle速度 |
| **端の周波数** | 端部分のwiggle速度 |
| **端の範囲 (%)** | 端とみなす範囲（0-50%） |
| **[プロパティ] - 中央の振幅** | 中央部分の揺れ幅 |
| **[プロパティ] - 端の振幅** | 端部分の揺れ幅 |

### 複数レイヤーモード

「Wiggle Control」ヌルオブジェクトに共通コントロールが追加され、すべてのレイヤーを一括で調整できます。

---

## アニメーションの仕組み

### 振幅の変化

```
振幅
 ↑
大 ┃━━━━┓              ┏━━━━┃
   ┃    ┗━━━━━━━━━━━━━━┛    ┃
小 ┃                        ┃
   ┗━━━━━━━━━━━━━━━━━━━━━━━━┛→ 時間
   inPoint            outPoint
```

- **端の範囲**: 始点/終点から指定した割合（デフォルト5%）
- **イージング**: easeIn/easeOutで滑らかに変化

### エクスプレッションの概要

```javascript
// 正規化された時間を計算
var normalizedTime = (time - inPoint) / (outPoint - inPoint);

// 端での強度を計算（イージング適用）
var intensity = 0;
if (normalizedTime < edgePercent) {
    intensity = 1 - easeOut(normalizedTime / edgePercent);
} else if (normalizedTime > 1 - edgePercent) {
    intensity = easeIn((normalizedTime - (1 - edgePercent)) / edgePercent);
}

// 振幅と周波数を補間
var currentAmp = minAmp + (maxAmp - minAmp) * intensity;
var currentFreq = minFreq + (maxFreq - minFreq) * intensity;

// wiggleを適用
wiggle(currentFreq, currentAmp);
```

---

## 使用例

### 登場/退場アニメーション

レイヤーが登場する時と退場する時に大きく揺れ、中間は安定した動きになります。

1. テキストやグラフィックレイヤーを選択
2. スクリプトを実行し、「位置」と「回転」を選択
3. 端の振幅を大きめに設定（位置: 100, 回転: 30）
4. 端の範囲を10%程度に設定

### 複数レイヤーの連動アニメーション

複数のレイヤーが同じタイミングで揺れ始め/揺れ終わるアニメーション。

1. 複数のレイヤーを選択
2. スクリプトを実行
3. 作成された「Wiggle Control」ヌルで一括調整

---

## トラブルシューティング

| 問題 | 原因 | 解決策 |
|------|------|--------|
| 揺れが見えない | 振幅が小さい | 端の振幅を大きくする |
| 動きがカクカクしすぎる | posterizeTimeが低い | Posterize Time Controlを上げる（24以上） |
| 特定レイヤーだけ動かない | エクスプレッションエラー | コンソールでエラーを確認 |

---

## ライセンス

このスクリプトはフリーで使用できます。

---

## 更新履歴

| バージョン | 内容 |
|-----------|------|
| 1.0.0 | 初期リリース |
