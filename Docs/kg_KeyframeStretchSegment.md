# kg_KeyframeStretchSegment.jsx

閉パス文字アウトラインの頂点を平行移動させ、Pathプロパティにキーフレームとして記録するAfter Effects用スクリプト。

## 概要

シェイプレイヤーのパス頂点を任意の方向に移動させ、元の形状と変形後の形状をキーフレームアニメーションとして記録します。文字のアウトラインを伸ばすようなアニメーションの作成に最適です。

## 動作環境

- Adobe After Effects CC以降
- ExtendScript対応バージョン

## インストール

1. `kg_KeyframeStretchSegment.jsx`を以下のいずれかに配置:
   - `C:\Program Files\Adobe\Adobe After Effects [version]\Support Files\Scripts\ScriptUI Panels\`
   - または任意のフォルダ

2. After Effectsを再起動

3. メニューから起動:
   - **Window** > **kg_KeyframeStretchSegment.jsx**
   - またはファイルメニューからスクリプトを実行

## UI構成

### Vertex Viewer（頂点ビューア）

| ボタン | 説明 |
|--------|------|
| **Show** | コンポジション内に全パスの頂点インデックスを表示。パスごとに色分けされ、頂点0には丸マーカーも表示。 |
| **Delete** | 表示したマーカーを全て削除 |
| **Load List** | パネル内のテキストエリアにASCII図形で頂点配置を視覚的に表示 |

**複数パス対応**: 「O」のような内側・外側がある文字でも、全てのパスの頂点を表示します。パスごとに異なる色（黄色、シアン、ピンクなど）で表示されます。

テキストエリアには以下のようなASCII図形で頂点が表示されます:
```
=== Path 1 (4 pts) ===
0---------1
|         |
|         |
3---------2

=== Path 2 (4 pts) ===
  0-----1
  |     |
  3-----2
```

### Direction (2 points)（方向指定）

| フィールド | 説明 |
|------------|------|
| **From** | 方向の始点となる頂点インデックス |
| **To** | 方向の終点となる頂点インデックス |

From → To の方向に頂点が移動します。

### Vertices to Move（移動する頂点）

移動させたい頂点のインデックスをカンマ区切りで入力します。

例: `1, 2, 3` → 頂点1、2、3が移動対象

### Parameters（パラメータ）

| パラメータ | 説明 | デフォルト |
|------------|------|------------|
| **Distance** | 移動距離（ピクセル） | 20 |
| **Duration** | アニメーション時間（秒） | 0.5 |

### Options（オプション）

| オプション | 説明 |
|------------|------|
| **Overwrite keys** | 同じ時刻に既存キーがある場合、上書きする |
| **Linear / Ease** | キーフレームの補間タイプ |

## 使用手順

1. **シェイプレイヤーを選択**
   - 文字アウトラインなど、閉パスを持つシェイプレイヤーを選択

2. **パスを選択**（推奨）
   - タイムライン上でパスプロパティを選択
   - 選択しない場合は最初のパスが対象になります

3. **頂点インデックスを確認**
   - **Show**ボタンをクリックしてマーカーを表示
   - または**Load List**で座標リストを確認

4. **方向を指定**
   - FromとToに2つの頂点インデックスを入力
   - 例: From=0, To=1 → 頂点0から頂点1への方向に移動

5. **移動する頂点を指定**
   - カンマ区切りでインデックスを入力
   - 例: `1, 2, 3`

6. **パラメータを設定**
   - Distance: 移動距離
   - Duration: アニメーション時間

7. **Keyframe Stretch ボタンをクリック**
   - 現在時刻（t0）に元の形状
   - t0 + Duration（t1）に変形後の形状
   - 2つのキーフレームが作成されます

8. **マーカーを削除**
   - **Delete**ボタンでマーカーを削除

## 使用例

### 斜め線を伸ばす

```
文字「K」の斜め線を伸ばす場合:

1. 「K」のアウトライン（シェイプレイヤー）を選択
2. 斜め線の頂点を確認: 例えば頂点2と頂点3が斜め線の端
3. 設定:
   - From: 2
   - To: 3
   - Vertices to Move: 3
   - Distance: 50
4. 実行 → 頂点3が頂点2→3方向に50px移動するアニメーション
```

### 複数頂点を同時に移動

```
四角形の右側を右に伸ばす場合:

頂点配置:
  [0]----[1]
   |      |
  [3]----[2]

設定:
- From: 0
- To: 1
- Vertices to Move: 1, 2
- Distance: 100

→ 頂点1と頂点2が右方向に100px移動
```

## 注意事項

- **閉パスのみ対応**: オープンパスには使用できません
- **シェイプレイヤー専用**: テキストレイヤーには直接使用不可（アウトライン化が必要）
- **マーカーの自動削除**: パネルを閉じるとマーカーは自動削除されます
- **Undo対応**: 全ての操作はUndo可能です

## トラブルシューティング

| 問題 | 解決策 |
|------|--------|
| "No layer selected" | シェイプレイヤーを選択してください |
| "Not a Shape Layer" | テキストの場合は「レイヤー > アウトラインを作成」を実行 |
| "No path found" | パスプロパティを選択するか、シェイプグループ内にパスがあることを確認 |
| "Path is not closed" | 閉パスのみ対応。オープンパスは使用不可 |
| "Index out of range" | 頂点数を確認してインデックスを修正 |

## 更新履歴

- **v1.0**: 初版リリース
  - 2点指定による方向決定
  - 複数頂点の同時移動
  - 頂点マーカー表示機能
  - パネル内頂点リスト表示
